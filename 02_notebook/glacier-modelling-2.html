
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Notebook 2 &#8212; Glacier Modelling cours</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '02_notebook/glacier-modelling-2';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Notebook 1" href="../01_notebook/glacier-modelling-1.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../infos.html">
  
  
  
  
  
  
    <p class="title logo__title">Glacier Modelling cours</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../infos.html">
                    Informations
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../00_introduction/00_introduction.html">Introduction</a></li>








































<li class="toctree-l1"><a class="reference internal" href="../00_project/project.html">Mini-project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../01_notebook/glacier-modelling-1.html">Notebook 1</a></li>


<li class="toctree-l1 current active"><a class="current reference internal" href="#">Notebook 2</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/02_notebook/glacier-modelling-2.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Notebook 2</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#goals-of-this-notebook">Goals of this notebook</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-igm">What is IGM?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-install-igm">How to install IGM?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#first-run-with-igm">First run with IGM</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#folder-exploration">Folder exploration</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#parameter-file-exploration">Parameter file exploration</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exploring-the-data-input-nc">Exploring the data (<code class="docutils literal notranslate"><span class="pre">input.nc</span></code>)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simple-surface-mass-balance">‘Simple’ Surface Mass Balance</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#running-igm-params-0">Running IGM (<code class="docutils literal notranslate"><span class="pre">params_0</span></code>)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#explore-the-output">Explore the output</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analyzing-the-time-series-results">Analyzing the time series results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#second-run-with-igm">Second run with IGM</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Analyzing the time series results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#third-run-with-igm">Third run with IGM</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-the-moraine-formation">Visualizing the moraine formation</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="notebook-2">
<h1>Notebook 2<a class="headerlink" href="#notebook-2" title="Link to this heading">#</a></h1>
<ul class="simple">
<li><p>If you work on Google Colab, <a class="reference external" href="https://colab.research.google.com/github/jouvetg/glamod/blob/main/02_notebook/glacier-modelling-2.ipynb"><img alt="open In Colab" src="https://colab.research.google.com/assets/colab-badge.svg" /></a> and you will donwload the repo in the first step below.</p></li>
<li><p>If you work locally on your own PC, you can download the repo</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>--depth<span class="w"> </span><span class="m">1</span><span class="w"> </span>https://github.com/jouvetg/glamod.git
</pre></div>
</div>
<p>and then go the notebook folder, and work from there.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span><span class="o">,</span><span class="w"> </span><span class="nn">os</span>
 
<span class="k">if</span> <span class="s2">&quot;google.colab&quot;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Running in Colab: cloning repo...&quot;</span><span class="p">)</span>
    <span class="o">!</span>git<span class="w"> </span>clone<span class="w"> </span>--depth<span class="w"> </span><span class="m">1</span><span class="w"> </span>https://github.com/jouvetg/glamod.git
    <span class="o">%</span><span class="k">cd</span> glamod/02_notebook
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Running locally: using local files.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="goals-of-this-notebook">
<h2>Goals of this notebook<a class="headerlink" href="#goals-of-this-notebook" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Get familiar with model IGM</p></li>
<li><p>Understand the parameters, set-up your model</p></li>
<li><p>Run IGM examples</p></li>
<li><p>Customization, run IGM for your own glacier</p></li>
</ul>
</section>
<section id="what-is-igm">
<h2>What is IGM?<a class="headerlink" href="#what-is-igm" title="Link to this heading">#</a></h2>
<p>Here we will use the glacier evolution model developed at UNIL – the Instructed Glacier Model.</p>
<p>The IGM is an open-source Python package, which permits to simulate 3D glacier evolution accounting for the coupling between ice thermo-dynamics, surface mass balance, and mass conservation. IGM is especially computationally efficient thanks to the TensorFlow library, mathematical operations are fully-vectorized. This permits important speed-ups on <a class="reference external" href="https://en.wikipedia.org/wiki/Graphics_processing_unit">GPU</a> (Graphics Processing Units), which are devices made of many processors, and can therefore perform highly-parallelized computations.</p>
<p>All the documentation can be found at <a class="reference external" href="https://igm-model.org/">https://igm-model.org/</a>.</p>
</section>
<section id="how-to-install-igm">
<h2>How to install IGM?<a class="headerlink" href="#how-to-install-igm" title="Link to this heading">#</a></h2>
<p>Running IGM consists of running a python script <code class="docutils literal notranslate"><span class="pre">igm_run</span></code>, which is made of functions of the <code class="docutils literal notranslate"><span class="pre">igm</span></code> python package.  First of all, one needs to install igm as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Installation of the igm package directly from the github repository, this may take a while</span>
<span class="o">!</span><span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-i<span class="w"> </span>https://test.pypi.org/simple/<span class="w"> </span>--extra-index-url<span class="w"> </span>https://pypi.org/simple<span class="w"> </span>--no-cache-dir<span class="w"> </span>igm-model-testing-package<span class="o">==</span><span class="m">3</span>.0.3
</pre></div>
</div>
</div>
</div>
<p>In this notebook, we will explore 3 model runs with increasing complexity:</p>
<ul class="simple">
<li><p>A first basic run with a simple surface mass balance model</p></li>
<li><p>A second one that works for any glacier, with a more elaborate SMB</p></li>
<li><p>A third with a user-defined SMB and particle tracking</p></li>
</ul>
</section>
<section id="first-run-with-igm">
<h2>First run with IGM<a class="headerlink" href="#first-run-with-igm" title="Link to this heading">#</a></h2>
<section id="folder-exploration">
<h3>Folder exploration<a class="headerlink" href="#folder-exploration" title="Link to this heading">#</a></h3>
<p>Let us explore the directory with the following command:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>tree
</pre></div>
</div>
</div>
</div>
<p>You will see the following files :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>.
├──<span class="w"> </span>data<span class="w">                 </span><span class="c1"># This folder contains all input data</span>
├──<span class="w"> </span>experiment<span class="w">           </span><span class="c1"># This folder contains the parameters</span>
│<span class="w">   </span>├──<span class="w"> </span>params_0.yaml
│<span class="w">   </span>├──<span class="w"> </span>...
└──<span class="w"> </span>user<span class="w">                 </span><span class="c1"># This folder contains user code</span>
<span class="w">    </span>├──<span class="w"> </span>code<span class="w"> </span>
<span class="w">    </span>└──<span class="w"> </span>conf<span class="w"> </span>
</pre></div>
</div>
</section>
<section id="parameter-file-exploration">
<h3>Parameter file exploration<a class="headerlink" href="#parameter-file-exploration" title="Link to this heading">#</a></h3>
<p>If you look at the parameter file, you will see the following content, which shows all the input, process, and output modules along with all their parameters. Below, you may notice that IGM: i) first loads a certain number of inputs, processes, and output modules, ii) second defines parameters associated with each module that deviate from default ones.</p>
<p>Here is the content of <code class="docutils literal notranslate"><span class="pre">params_0.yaml</span></code>, taken from IGM’s example <code class="docutils literal notranslate"><span class="pre">aletsch-basic</span></code>. Here, IGM loads data with the <code class="docutils literal notranslate"><span class="pre">local</span></code> module, proceeds to a simulation from 1900 to 2000 updating surface mass balance (<code class="docutils literal notranslate"><span class="pre">smb</span></code>), iceflow, time, and ice thickness. Then, it writes the results in both a local file (NetCDF file) and in the form of plots.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># @package _global_</span>

<span class="nt">defaults</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">override /inputs</span><span class="p">:</span><span class="w"> </span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local</span><span class="w">                    </span><span class="c1"># load local input module</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">override /processes</span><span class="p">:</span><span class="w"> </span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">smb_simple</span><span class="w">               </span><span class="c1"># load smb_simple processes module</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">iceflow</span><span class="w">                  </span><span class="c1"># load iceflow processes module</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">time</span><span class="w">                     </span><span class="c1"># load time processes module</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">thk</span><span class="w">                      </span><span class="c1"># load thk processes module</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">override /outputs</span><span class="p">:</span><span class="w"> </span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local</span><span class="w">                    </span><span class="c1"># load local outputs module</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">plot2d</span><span class="w">                   </span><span class="c1"># load plot2d outputs module</span>

<span class="nt">inputs</span><span class="p">:</span>
<span class="w">  </span><span class="nt">local</span><span class="p">:</span>
<span class="w">     </span><span class="nt">filename</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">input-aletsch.nc</span><span class="w">   </span><span class="c1"># The local model will load the input-aletsch.nc file</span>

<span class="nt">processes</span><span class="p">:</span>
<span class="w">  </span><span class="nt">smb_simple</span><span class="p">:</span>
<span class="w">    </span><span class="nt">array</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;time&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;gradabl&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;gradacc&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;ela&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;accmax&quot;</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">1900</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0.009</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0.005</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">2800</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">2.0</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">2000</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0.009</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0.005</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">2900</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">2.0</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">2100</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0.009</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0.005</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">3300</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">2.0</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">time</span><span class="p">:</span>
<span class="w">    </span><span class="nt">start</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1900.0</span>
<span class="w">    </span><span class="nt">end</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2000.0</span>
<span class="w">    </span><span class="nt">save</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.0</span>
<span class="w">    </span>
<span class="nt">outputs</span><span class="p">:</span>
<span class="w">  </span><span class="nt">plot2d</span><span class="p">:</span>
<span class="w">    </span><span class="nt">live</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
</pre></div>
</div>
<p>IGM is organized <strong>module-wise</strong> as shown in the following flowchart:</p>
<p><img alt="" src="https://igm-model.org/latest/modules/flowchat-module.png" /></p>
<p>As a user, you need to pick an ensemble of modules from existing ones (or you may create some user ones), and then define the parameters that deviate from default ones.</p>
</section>
<section id="exploring-the-data-input-nc">
<h3>Exploring the data (<code class="docutils literal notranslate"><span class="pre">input.nc</span></code>)<a class="headerlink" href="#exploring-the-data-input-nc" title="Link to this heading">#</a></h3>
<p>Before running IGM, it’s useful to explore the input data file. The <code class="docutils literal notranslate"><span class="pre">input.nc</span></code> file is a NetCDF file that contains all the necessary spatial data for the glacier simulation, such as the bed topography, initial ice thickness, and other geographic information.</p>
<p>We can use the <code class="docutils literal notranslate"><span class="pre">xarray</span></code> library to easily load and explore NetCDF files. Let’s look at what’s inside the <code class="docutils literal notranslate"><span class="pre">input.nc</span></code> file:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="c1"># Load the NetCDF file</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="s1">&#39;data/input-aletsch.nc&#39;</span><span class="p">)</span>

<span class="c1"># Display the dataset structure</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Dataset structure:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">60</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Show data variables</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Data variables:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">data_vars</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">ds</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;long_name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;No description&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Shape: </span><span class="si">{</span><span class="n">ds</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">, Units: </span><span class="si">{</span><span class="n">ds</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;units&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N/A&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">60</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now let’s visualize some of the key fields in the input data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a figure with multiple subplots to visualize the data</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="c1"># Plot bed topography (topg)</span>
<span class="n">ds</span><span class="p">[</span><span class="s1">&#39;usurf&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;terrain&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Surface Topography&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

<span class="c1"># Plot ice thickness (thk) </span>
<span class="n">ds</span><span class="p">[</span><span class="s1">&#39;thk&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Ice Thickness&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

<span class="c1"># Plot ice mask </span>
<span class="n">ds</span><span class="p">[</span><span class="s1">&#39;icemask&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Ice Mask&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
 
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>What you see above shows raster grids of top surface elevation, ice thickness, and ice mask for the Aletsch Glacier at a spatial resolution of 100 m.</p>
</section>
<section id="simple-surface-mass-balance">
<h3>‘Simple’ Surface Mass Balance<a class="headerlink" href="#simple-surface-mass-balance" title="Link to this heading">#</a></h3>
<p>The snow accumulation budget (which turns into ice) at altitude and ice melt depends on precipitation and temperature. This mass balance <span class="math notranslate nohighlight">\(SMB(z)\)</span> is commonly defined as a function of altitude and depends on different factors:</p>
<ul class="simple">
<li><p>A slope that controls the mass balance gradients in both the accumulation <span class="math notranslate nohighlight">\(b_\mathrm{acc}\)</span> and the ablation area <span class="math notranslate nohighlight">\(b_\mathrm{abl}\)</span></p></li>
<li><p>A maximum value for accumulation <span class="math notranslate nohighlight">\(b_\mathrm{max}\)</span></p></li>
<li><p>The altitude of the equilibrium line <span class="math notranslate nohighlight">\(z_\mathrm{ELA}\)</span> beyond which ice accumulates and below which ice melts</p></li>
</ul>
<p>Mathematically, <span class="math notranslate nohighlight">\(SMB(z)\)</span> can be expressed as a piecewise function:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
SMB(z) = \begin{cases}
b_\mathrm{abl} \cdot (z - z_\mathrm{ELA}) &amp; \text{if } z &lt; z_\mathrm{ELA} \text{ (ablation zone)} \\
\min(b_\mathrm{acc} \cdot (z - z_\mathrm{ELA}), b_\mathrm{max}) &amp; \text{if } z \geq z_\mathrm{ELA} \text{ (accumulation zone)}
\end{cases}
\end{split}\]</div>
<p>The code in the next block gives an example of SMB function as a function of elevation <span class="math notranslate nohighlight">\(z\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="n">z_ELA</span><span class="o">=</span><span class="mf">3000.0</span>
<span class="n">grad_abl</span><span class="o">=</span><span class="mf">0.009</span>
<span class="n">grad_acc</span><span class="o">=</span><span class="mf">0.005</span>
<span class="n">b_max</span><span class="o">=</span><span class="mf">2.0</span> 

<span class="k">def</span><span class="w"> </span><span class="nf">smb_fct</span><span class="p">(</span><span class="n">elev</span><span class="p">):</span>
    <span class="n">smb</span> <span class="o">=</span> <span class="n">elev</span> <span class="o">-</span> <span class="n">z_ELA</span>
    <span class="n">smb</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">smb</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">grad_abl</span><span class="p">,</span> <span class="n">grad_acc</span><span class="p">)</span> 
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">smb</span><span class="p">,</span> <span class="n">b_max</span><span class="p">)</span>

<span class="n">elev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">2000.0</span><span class="p">,</span> <span class="mf">4000.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">z_ELA</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;ELA&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">smb_fct</span><span class="p">(</span><span class="n">elev</span><span class="p">),</span> <span class="n">elev</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Altitude [m]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;SMB [m/y]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Example of SMB as a function of elevation&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="running-igm-params-0">
<h3>Running IGM (<code class="docutils literal notranslate"><span class="pre">params_0</span></code>)<a class="headerlink" href="#running-igm-params-0" title="Link to this heading">#</a></h3>
<p>Now, we can run IGM by simply running the command <code class="docutils literal notranslate"><span class="pre">igm_run</span> <span class="pre">+experiment=params_0</span></code> (or replace <code class="docutils literal notranslate"><span class="pre">params_0</span></code> with the actual name of your parameter file) in the corresponding folder to execute the example. This will model the evolution of Aletsch Glacier for 100 years given the Surface Mass Balance parameters specified in the parameter file.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>igm_run<span class="w"> </span>+experiment<span class="o">=</span>params_0
</pre></div>
</div>
</div>
</div>
</section>
<section id="explore-the-output">
<h3>Explore the output<a class="headerlink" href="#explore-the-output" title="Link to this heading">#</a></h3>
<p>Each IGM run will generate a folder with the date as the parent folder and the time as a subfolder. For instance, after a few runs we could end up with the following structure:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>outputs
<span class="w">  </span>└───2025-04-07
<span class="w">      </span>├───<span class="w"> </span><span class="m">12</span>-06-29<span class="w"> </span>
<span class="w">      </span>└───<span class="w"> </span><span class="m">12</span>-07-38<span class="w"> </span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>tree
</pre></div>
</div>
</div>
</div>
<p>After the IGM run, you may have a quick look at the results by exploring:</p>
<ul class="simple">
<li><p>Files <code class="docutils literal notranslate"><span class="pre">velbar_mag-19XX.0.png</span></code> that display ice speed and extent over the simulation time</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">output.nc</span></code> that stores all the spatio-temporal output results</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">output_ts.nc</span></code> that stores all time-dependent volume and area data</p></li>
</ul>
<p>Using the helper function, you can visualize the results:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">helper</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">glob</span>

<span class="c1"># Find all output files</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;outputs/*/*/output.nc&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="si">}</span><span class="s2"> output file(s):&quot;</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span>

<span class="k">if</span> <span class="n">A</span><span class="p">:</span>
    <span class="c1"># Animate the last run</span>
    <span class="n">animate_glacier_evolution</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No output.nc files found. Please run the model first.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="analyzing-the-time-series-results">
<h3>Analyzing the time series results<a class="headerlink" href="#analyzing-the-time-series-results" title="Link to this heading">#</a></h3>
<p>Let’s examine how the glacier ice volume and ice area evolved over the simulation period by reading the <code class="docutils literal notranslate"><span class="pre">output_ts.nc</span></code> file:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">helper</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">glob</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="c1"># Find all time series files and select the most recent one</span>
<span class="n">ts_files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;outputs/*/*/output_ts.nc&#39;</span><span class="p">))</span>

<span class="k">if</span> <span class="n">ts_files</span><span class="p">:</span>
    <span class="c1"># Get the absolute path to ensure it works from any directory</span>
    <span class="n">ts_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">ts_files</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">ts_files</span><span class="p">)</span><span class="si">}</span><span class="s2"> time series file(s). Using: </span><span class="si">{</span><span class="n">ts_files</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># Analyze the time series from the most recent run</span>
    <span class="n">analyze_time_series</span><span class="p">(</span><span class="n">ts_file</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No output_ts.nc file found. Please run the model first.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Congratulations! You have successfully run your first glacier model simulation using the IGM package. You can now explore different parameters and scenarios to see how they affect glacier dynamics. Happy modeling!</p>
<p>You may now try to modify some parameters in the configuration file <code class="docutils literal notranslate"><span class="pre">params_0.yaml</span></code> and rerun the simulation to observe how changes impact the glacier’s behavior.</p>
<p><strong>Tips:</strong> Create a new parameter file by copying <code class="docutils literal notranslate"><span class="pre">params_0.yaml</span></code> to <code class="docutils literal notranslate"><span class="pre">params_0_student.yaml</span></code> and modify it. Then run the simulation with the command <code class="docutils literal notranslate"><span class="pre">igm_run</span> <span class="pre">+experiment=params_0_student</span></code>.</p>
</section>
</section>
<section id="second-run-with-igm">
<h2>Second run with IGM<a class="headerlink" href="#second-run-with-igm" title="Link to this heading">#</a></h2>
<p>The above example is somewhat limited. In a second run, we are making improvements using <code class="docutils literal notranslate"><span class="pre">params_1.yaml</span></code> instead of <code class="docutils literal notranslate"><span class="pre">params_0.yaml</span></code>:</p>
<p><strong>First improvement:</strong> Instead of using local data, we use the module <code class="docutils literal notranslate"><span class="pre">oggm_shop</span></code> to download all necessary data. The main advantage is that we can order any glacier using their RGI ID, and therefore get the data for any glacier on Earth!</p>
<p><strong>Second improvement:</strong> OGGM will download climate data (a time series), which will serve to generate a climate (temperature and precipitation in module <code class="docutils literal notranslate"><span class="pre">clim_oggm</span></code>) to compute a better Surface Mass Balance model. Note this parameter in the parameter file:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="nt">clim_oggm</span><span class="p">:</span>
<span class="w">    </span><span class="nt">clim_trend_array</span><span class="p">:</span><span class="w"> </span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;time&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;delta_temp&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;prec_scal&quot;</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">1900</span><span class="p p-Indicator">,</span><span class="w">           </span><span class="nv">0.0</span><span class="p p-Indicator">,</span><span class="w">         </span><span class="nv">1.0</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">2020</span><span class="p p-Indicator">,</span><span class="w">           </span><span class="nv">0.0</span><span class="p p-Indicator">,</span><span class="w">         </span><span class="nv">1.0</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">2100</span><span class="p p-Indicator">,</span><span class="w">           </span><span class="nv">4.0</span><span class="p p-Indicator">,</span><span class="w">         </span><span class="nv">1.0</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>Similar to the previous method, this array assigns weights to modify precipitation and temperature series based on a <em>neutral</em> climate period, typically defined as 1960-1990. By adjusting the temperature offset in the <code class="docutils literal notranslate"><span class="pre">delta_temp</span></code> column, for example, a value of -2.0 would create a climate scenario for the 1960-1990 period that is 2 degrees cooler. Likewise, by modifying the precipitation scaling in the <code class="docutils literal notranslate"><span class="pre">prec_scal</span></code> column, a value of 1.5 would result in a climate scenario that has 150% of the precipitation compared to the 1960-1990 average.</p>
<p>Finally, you can incorporate this parameter to provide global control for melt (note that the melt parameters in the PDD model are notoriously uncertain):</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="w">   </span><span class="nt">melt_enhancer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.7</span>
</pre></div>
</div>
<p>Find more information about the generated climate <a class="reference external" href="https://igm-model.org/latest/modules/processes/clim_oggm/">here</a>.</p>
<p><strong>Third improvement:</strong> Instead of using the Simple Surface Mass Balance <code class="docutils literal notranslate"><span class="pre">smb_simple</span></code>, and now that we have climate available, we will use the <code class="docutils literal notranslate"><span class="pre">smb_oggm</span></code> SMB, which is a monthly temperature index model as described <a class="reference external" href="https://igm-model.org/latest/modules/processes/smb_oggm/">here</a>.</p>
<p>First explore <code class="docutils literal notranslate"><span class="pre">params_1.yaml</span></code>, then run the following command, which will model the Glacier with RGI ID <code class="docutils literal notranslate"><span class="pre">RGI60-11.01450</span></code> (the Great Aletsch Glacier, Switzerland) from 2020 to 2100, assuming a temperature increase of 4 degrees by 2100 relative to 1960–1990:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span><span class="w"> </span>igm_run<span class="w"> </span>+experiment<span class="o">=</span>params_1
</pre></div>
</div>
</div>
</div>
<p>Running the code has created the following output files:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">helper</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">glob</span>

<span class="c1"># Find all output files</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;outputs/*/*/output.nc&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="si">}</span><span class="s2"> output file(s):&quot;</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span>

<span class="k">if</span> <span class="n">A</span><span class="p">:</span>
    <span class="c1"># Animate the last run</span>
    <span class="n">animate_glacier_evolution</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No output.nc files found. Please run the model first.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="id1">
<h3>Analyzing the time series results<a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<p>Let’s examine how the glacier evolved under the climate scenario:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">helper</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">glob</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="c1"># Find all time series files and select the most recent one</span>
<span class="n">ts_files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;outputs/*/*/output_ts.nc&#39;</span><span class="p">))</span>

<span class="k">if</span> <span class="n">ts_files</span><span class="p">:</span>
    <span class="c1"># Get the absolute path to ensure it works from any directory</span>
    <span class="n">ts_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">ts_files</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">ts_files</span><span class="p">)</span><span class="si">}</span><span class="s2"> time series file(s). Using: </span><span class="si">{</span><span class="n">ts_files</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># Analyze the time series from the most recent run</span>
    <span class="n">analyze_time_series</span><span class="p">(</span><span class="n">ts_file</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No output_ts.nc file found. Please run the model first.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="third-run-with-igm">
<h2>Third run with IGM<a class="headerlink" href="#third-run-with-igm" title="Link to this heading">#</a></h2>
<p>In a third run, we will bring 2 additional new features (explore the parameter file <code class="docutils literal notranslate"><span class="pre">params_2.yaml</span></code>):</p>
<p><strong>First new feature:</strong> Using a <strong>custom SMB function</strong> that is defined in the <code class="docutils literal notranslate"><span class="pre">user</span></code> folder. Explore the <code class="docutils literal notranslate"><span class="pre">user</span></code> folder and the parameter file <code class="docutils literal notranslate"><span class="pre">params_2.yaml</span></code> to see how custom code can be integrated.</p>
<p><strong>Second new feature:</strong> We activate a particle tracking module to simulate the displacement of virtual particles within the ice flow. These particles may represent debris or sediments that are transported by the glacier and are responsible for the formation of moraines. Our goal is to model the formation of the main moraine that developed during the Little Ice Age when the glacier reached its maximum extent.</p>
<p>To achieve this, we have made 2 changes to the parameter file <code class="docutils literal notranslate"><span class="pre">params_2.yaml</span></code>:</p>
<ol class="arabic simple">
<li><p>We added two modules: <code class="docutils literal notranslate"><span class="pre">vert_flow</span></code> and <code class="docutils literal notranslate"><span class="pre">particles</span></code>. The <code class="docutils literal notranslate"><span class="pre">vert_flow</span></code> module computes vertical velocities (which is not done by default as it is not usually required), while the <code class="docutils literal notranslate"><span class="pre">particles</span></code> module tracks the trajectory of individual particles.</p></li>
<li><p>We added the following parameters:</p></li>
</ol>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="nt">vflo_method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kinematic</span>
<span class="w">  </span><span class="nt">tracking_method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3d</span>
<span class="w">  </span><span class="nt">density_seeding</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.25</span>
<span class="w">  </span><span class="nt">frequency_seeding</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span>
</pre></div>
</div>
<p>It is possible to visualize the moraine formed by looking at the file <code class="docutils literal notranslate"><span class="pre">velbar_mag-XXXX.0.png</span></code>.</p>
<p>Run the following command:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span><span class="w"> </span>igm_run<span class="w"> </span>+experiment<span class="o">=</span>params_2
</pre></div>
</div>
</div>
</div>
<section id="visualizing-the-moraine-formation">
<h3>Visualizing the moraine formation<a class="headerlink" href="#visualizing-the-moraine-formation" title="Link to this heading">#</a></h3>
<p>After the simulation completes, let’s visualize the results including the particle tracking:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">helper</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">glob</span>

<span class="c1"># Find all output files</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;outputs/*/*/output.nc&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="si">}</span><span class="s2"> output file(s):&quot;</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span>

<span class="k">if</span> <span class="n">A</span><span class="p">:</span>
    <span class="c1"># Animate the last run showing particles/moraines</span>
    <span class="n">animate_glacier_evolution</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No output.nc files found. Please run the model first.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./02_notebook"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../01_notebook/glacier-modelling-1.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Notebook 1</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#goals-of-this-notebook">Goals of this notebook</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-igm">What is IGM?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-install-igm">How to install IGM?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#first-run-with-igm">First run with IGM</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#folder-exploration">Folder exploration</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#parameter-file-exploration">Parameter file exploration</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exploring-the-data-input-nc">Exploring the data (<code class="docutils literal notranslate"><span class="pre">input.nc</span></code>)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simple-surface-mass-balance">‘Simple’ Surface Mass Balance</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#running-igm-params-0">Running IGM (<code class="docutils literal notranslate"><span class="pre">params_0</span></code>)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#explore-the-output">Explore the output</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analyzing-the-time-series-results">Analyzing the time series results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#second-run-with-igm">Second run with IGM</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Analyzing the time series results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#third-run-with-igm">Third run with IGM</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-the-moraine-formation">Visualizing the moraine formation</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Guillaume Jouvet
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>